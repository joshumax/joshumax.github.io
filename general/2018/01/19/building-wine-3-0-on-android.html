<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.1" /><meta property="og:title" content="Building Wine 3.0 for Android" /><meta property="og:locale" content="en" /><meta name="description" content="A guide on how to get Wine working on your Android device" /><meta property="og:description" content="A guide on how to get Wine working on your Android device" /><link rel="canonical" href="https://joshumax.github.io/general/2018/01/19/building-wine-3-0-on-android.html" /><meta property="og:url" content="https://joshumax.github.io/general/2018/01/19/building-wine-3-0-on-android.html" /><meta property="og:site_name" content="Josh Talk" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2018-01-19T00:00:00+00:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Building Wine 3.0 for Android" /><meta name="twitter:site" content="@joshumax" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2018-01-19T00:00:00+00:00","datePublished":"2018-01-19T00:00:00+00:00","description":"A guide on how to get Wine working on your Android device","headline":"Building Wine 3.0 for Android","mainEntityOfPage":{"@type":"WebPage","@id":"https://joshumax.github.io/general/2018/01/19/building-wine-3-0-on-android.html"},"url":"https://joshumax.github.io/general/2018/01/19/building-wine-3-0-on-android.html"}</script><title>Building Wine 3.0 for Android | Josh Talk</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Josh Talk"><meta name="application-name" content="Josh Talk"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" alt="avatar" class="mx-auto"> <img src=" https://avatars2.githubusercontent.com/u/1807142?v=3&s=128 " alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">Josh Talk</a></div><div class="site-subtitle font-italic">The official blog of joshumax</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/joshumax" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/joshumax" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['mail','joshumax.me'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper" class="row justify-content-center"><div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Building Wine 3.0 for Android</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper"><div id="main"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-8"><div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><h1 data-toc-skip>Building Wine 3.0 for Android</h1><div class="post-meta text-muted"><div> By <em> <a href="https://twitter.com/joshumax">Josh Max</a> </em></div><div class="d-flex"><div> <span> Posted <em class="timeago" data-ts="1516320000" data-toggle="tooltip" data-placement="bottom" data-tooltip-df="llll" > 2018-01-19 </em> </span> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="1262 words"> <em>7 min</em> read</span></div></div></div><div class="post-content"><p><img data-src="https://i.imgur.com/e5pd4Ab.png?1" alt="Wine on Android ARM" data-proofer-ignore></p><p>Yesterday marked the official release of <a href="https://www.winehq.org/announce/3.0"><code class="language-plaintext highlighter-rouge">Wine 3.0</code></a>, bringing a multitude of bugfixes, support improvements, and long-awaited features. Among these is the initial release of the Android support drivers for the Wine platform. Naturally, when I heard the news I was excited to try it out! However, I was disappointed to find a complete and utter lack of documentation on building it for Android. This post is a collection of test notes and build steps to jump right into getting Wine running on your ARM/ARM64/x86 Android, as well as Wine on Android development for potential contributors.</p><p><strong><em>Disclaimer: Wine on Android is still very much under development and may not work for all devices, architectures, and graphics drivers. Additionally, Wine Qemu integration for Android is not yet fully complete, meaning you will currently ONLY be able to run Win32 applications on x86 devices and WinRT applications on ARM devices. See <a href="https://forum.xda-developers.com/showthread.php?t=2092348">https://forum.xda-developers.com/showthread.php?t=2092348</a> for a list of programs ported to WinRT.</em></strong></p><h2 id="prerequisites"><span class="mr-2">Prerequisites</span><a href="#prerequisites" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>In order to build Wine for Android, you’re going to need a few prerequisites:</p><ul><li>For starters, you’re going to need <code class="language-plaintext highlighter-rouge">gradle</code>, which can easily be acquired on Debian-based distros by running<div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre> <span class="nb">sudo </span>apt <span class="nb">install </span>gradle
</pre></table></code></div></div><li>Additionally, you’re going to need to build Wine for your host system first, so go ahead and grab all the necessary dependencies. For Debian-based operating systems, that can be done by running<div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre> <span class="nb">sudo </span>apt build-dep wine
</pre></table></code></div></div><li><p>Next, you’re going to need the <code class="language-plaintext highlighter-rouge">Android SDK</code>. Installation instructions depend on your platform and more information on how to install it can be attained at the Android Studio website <a href="https://developer.android.com/studio/index.html">https://developer.android.com/studio/index.html</a>. Once you’ve finished installing Android Studio, open SDK manager and install the Android 21 (5.0) SDK tools. When this is done, export the environment variable <code class="language-plaintext highlighter-rouge">$ANDROID_HOME</code> to point to the SDK manager directory.</p><li>Finally, you’ll want to get the <code class="language-plaintext highlighter-rouge">Android NDK</code> to compile Wine for the Android platform. Information on how to install this component is over at <a href="https://developer.android.com/ndk/index.html">https://developer.android.com/ndk/index.html</a>. When you’ve installed the NDK somewhere, export the environment variable <code class="language-plaintext highlighter-rouge">$NDK_ROOT</code> to point to the top directory of the NDK (i.e. the one with <code class="language-plaintext highlighter-rouge">ndk-build</code> in it).</ul><h2 id="building"><span class="mr-2">Building</span><a href="#building" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>Okay, so you made it this far. Congratulations!</p><p>This guide assumes that all building will take place in <code class="language-plaintext highlighter-rouge">~/wine-android</code>, so go ahead and create that:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">mkdir</span> ~/wine-android <span class="o">&amp;&amp;</span> <span class="nb">cd</span> ~/wine-android
</pre></table></code></div></div><p>Next, grab a copy of Wine from <a href="http://winehq.org">http://winehq.org</a> and extract it:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>wget https://dl.winehq.org/wine/source/3.0/wine-3.0.tar.xz
<span class="nb">tar </span>xf wine-3.0.tar.xz
</pre></table></code></div></div><p>Now you should have a directory called <code class="language-plaintext highlighter-rouge">wine-3.0</code> in <code class="language-plaintext highlighter-rouge">~/wine-android</code>, go ahead and copy it (we’re going to need to build a native version of Wine first).</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">cp</span> <span class="nt">-r</span> wine-3.0 wine-3.0-native
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">cd</code> into it:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">cd </span>wine-3.0-native
</pre></table></code></div></div><p>And build Wine for your host system. A guide on how to do this can be found <a href="https://wiki.winehq.org/Building_Wine"><code class="language-plaintext highlighter-rouge">here</code></a> but basically the commands to build are as follows:</p><p><strong>For 32-bit host:</strong></p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>./configure
</pre></table></code></div></div><p><strong>For 64-bit host:</strong></p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>./configure <span class="nt">--enable-win64</span> <span class="c"># No use in building useless i686 support</span>
</pre></table></code></div></div><p>Next run:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>make
</pre></table></code></div></div><p>and you’re done! Building for the host first is necessary because we’ll need everything in the <code class="language-plaintext highlighter-rouge">tools/</code> directory to cross-compile. <code class="language-plaintext highlighter-rouge">cd</code> back to the parent directory:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">cd</span> ..
</pre></table></code></div></div><p>Now it’s time to get ready to cross-compile! Depending on what architecture you want, you’ll have to use a different toolchain. Some common ones have been listed:</p><p><strong>For 32-bit ARM targets:</strong></p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="nb">export </span><span class="nv">TOOLCHAIN_VERSION</span><span class="o">=</span><span class="s2">"arm-linux-androideabi-4.9"</span>
<span class="nb">export </span><span class="nv">TOOLCHAIN_TRIPLE</span><span class="o">=</span><span class="s2">"arm-linux-androideabi"</span>
</pre></table></code></div></div><p><strong>For 64-bit ARM targets:</strong></p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="nb">export </span><span class="nv">TOOLCHAIN_VERSION</span><span class="o">=</span><span class="s2">"aarch64-linux-android-4.9"</span>
<span class="nb">export </span><span class="nv">TOOLCHAIN_TRIPLE</span><span class="o">=</span><span class="s2">"aarch64-linux-android"</span>
</pre></table></code></div></div><p><strong>For 32-bit x86 targets:</strong></p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="nb">export </span><span class="nv">TOOLCHAIN_VERSION</span><span class="o">=</span><span class="s2">"x86-4.9"</span>
<span class="nb">export </span><span class="nv">TOOLCHAIN_TRIPLE</span><span class="o">=</span><span class="s2">"i686-linux-android"</span>
</pre></table></code></div></div><p>When you’ve exported the proper toolchain version, build a standalone toolchain using the following command:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nv">$NDK_ROOT</span>/build/tools/make-standalone-toolchain.sh <span class="nt">--platform</span><span class="o">=</span>android-21 <span class="nt">--install-dir</span><span class="o">=</span>android-toolchain <span class="nt">--toolchain</span><span class="o">=</span><span class="nv">$TOOLCHAIN_VERSION</span>
</pre></table></code></div></div><p>This should hopefully complete without error and create the directory <code class="language-plaintext highlighter-rouge">android-toolchain/</code>. Export it to your <code class="language-plaintext highlighter-rouge">$PATH</code>:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">export </span><span class="nv">PATH</span><span class="o">=</span><span class="sb">`</span><span class="nb">pwd</span><span class="sb">`</span>/android-toolchain/bin:<span class="nv">$PATH</span>
</pre></table></code></div></div><p>Next, we’re going to need to download and build <code class="language-plaintext highlighter-rouge">Freetype2</code> for Android. Freetype is necessary to render fonts in Wine. Download and extract Freetype using the following commands:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>wget https://download.savannah.gnu.org/releases/freetype/freetype-2.6.tar.gz
</pre></table></code></div></div><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">tar </span>xf freetype-2.6.tar.gz
</pre></table></code></div></div><p>Now <code class="language-plaintext highlighter-rouge">cd</code> into the newly-created directory to begin cross-compiling Freetype.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">cd </span>freetype-2.6
</pre></table></code></div></div><p>Now that you’re in the source tree of Freetype, run the <code class="language-plaintext highlighter-rouge">configure</code> script like so:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>./configure <span class="nt">--host</span><span class="o">=</span><span class="nv">$TOOLCHAIN_TRIPLE</span> <span class="nt">--prefix</span><span class="o">=</span><span class="sb">`</span><span class="nb">pwd</span><span class="sb">`</span>/output <span class="nt">--without-zlib</span> <span class="nt">--with-png</span><span class="o">=</span>no <span class="nt">--with-harfbuzz</span><span class="o">=</span>no
</pre></table></code></div></div><p>After that’s complete, build and install Freetype to <code class="language-plaintext highlighter-rouge">output/</code>:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>make <span class="nt">-j</span><span class="sb">`</span><span class="nb">nproc</span><span class="sb">`</span> <span class="o">&amp;&amp;</span> make <span class="nb">install</span>
</pre></table></code></div></div><p>Congratulations! You’ve successfully compiled Freetype for Android, now onto Wine!</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">cd</span> ../wine-3.0
</pre></table></code></div></div><p>Wine configuration is a bit trickier, but if we set a few environment variables it should work just fine. First, let’s work around an optimization bug for certain versions of <code class="language-plaintext highlighter-rouge">gcc</code> when compiling Wine:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">export </span><span class="nv">CFLAGS</span><span class="o">=</span><span class="s2">"-O2"</span>
</pre></table></code></div></div><p>Now we’re going to need to tell the configuration scripts where we placed the Freetype library and headers. This can be done by exporting their respective directory paths:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="nb">export </span><span class="nv">FREETYPE_CFLAGS</span><span class="o">=</span><span class="s2">"-I</span><span class="sb">`</span><span class="nb">pwd</span><span class="sb">`</span><span class="s2">/../freetype-2.6/output/include/freetype2"</span>
<span class="nb">export </span><span class="nv">FREETYPE_LIBS</span><span class="o">=</span><span class="s2">"-L</span><span class="sb">`</span><span class="nb">pwd</span><span class="sb">`</span><span class="s2">/../freetype-2.6/output/lib"</span>
</pre></table></code></div></div><p>Now run <code class="language-plaintext highlighter-rouge">configure</code> in the Wine directory like so:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>./configure <span class="nt">--host</span><span class="o">=</span><span class="nv">$TOOLCHAIN_TRIPLE</span> <span class="nv">host_alias</span><span class="o">=</span><span class="nv">$TOOLCHAIN_TRIPLE</span> <span class="se">\</span>
    <span class="nt">--with-wine-tools</span><span class="o">=</span>../wine-3.0-native <span class="nt">--prefix</span><span class="o">=</span><span class="sb">`</span><span class="nb">pwd</span><span class="sb">`</span>/dlls/wineandroid.drv/assets
</pre></table></code></div></div><p>The configuration should work just fine, however if you get any errors related to Freetype, you likely exported your <code class="language-plaintext highlighter-rouge">Freetype2</code> build locations incorrectly. Assuming everything worked correctly, you can now build Wine for Android like so:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>make <span class="nt">-j</span><span class="sb">`</span><span class="nb">nproc</span><span class="sb">`</span> <span class="o">&amp;&amp;</span> make <span class="nb">install</span>
</pre></table></code></div></div><p>If there were no compilation errors, you can now proceed to copy the Freetype shared library you built over to the Wine Android driver assets.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="c"># YOUR_ARCH will be the architecture code of the platform you're building for (e.g. armv7-a, x86, etc.)</span>
<span class="nb">cp</span> ../freetype-2.6/output/lib/libfreetype.so dlls/wineandroid.drv/assets/YOUR_ARCH/lib/
</pre></table></code></div></div><p>Next, <code class="language-plaintext highlighter-rouge">cd</code> into the Wine Android driver directory to begin packaging:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="nb">cd </span>dlls/wineandroid.drv/
</pre></table></code></div></div><p>There will already be an APK in this directory, but it’s missing the necessary assets, so clean up.</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>make clean
</pre></table></code></div></div><p>Now run <code class="language-plaintext highlighter-rouge">make</code> again to build the proper APK:</p><div class="language-bash highlighter-rouge"><div class="code-header"> <span data-label-text="Shell"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>make
</pre></table></code></div></div><p>If everything works correctly, you should have a file <code class="language-plaintext highlighter-rouge">wine-debug.apk</code> that’s <code class="language-plaintext highlighter-rouge">~50MB</code> in size! Copy it over to your device’s storage, or install it using <code class="language-plaintext highlighter-rouge">adb</code>.</p><h2 id="issues"><span class="mr-2">Issues</span><a href="#issues" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>One of the biggest issues I’ve noticed so far is that Wine refuses to load the desktop shell on certain devices. This seems to be related to certain problems with some graphics hardware/drivers. Unfortunately there’s not a whole lot I can do about it at this point. I’m actively hacking the Wine codebase in order to try and fix this up. One notorious example of this is trying to load it on an Atom AVD using native graphics on desktop NVIDIA hardware. Disable native graphics to make it work. For phones and tablets that have trouble, you may have some luck toggling <code class="language-plaintext highlighter-rouge">Force GPU Rendering</code> in developer options.</p><p>Another issue surrounds the Task Bar and Window sizing. On some devices the Start menu is unusable and the only way to access programs is through the Wine console. I’m working in getting this issue fixed up as it seems to be okay in the automated builds. As for the window sizing issue, just launch <code class="language-plaintext highlighter-rouge">winecfg.exe</code> and set the display DPI to your liking.</p><p>While Wine supports input through the touchscreen and virtual keyboard, it doesn’t open up automatically when you select an input box. Once again, I’m working on getting this fixed. In the meantime, you can pair a bluetooth keyboard up to your device, or install <a href="https://play.google.com/store/apps/details?id=org.pocketworkstation.pckeyboard"><code class="language-plaintext highlighter-rouge">Hacker's Keyboard</code></a> and enable the persistent notification to open the keyboard when it’s pressed.</p><p>Finally, for those who compiled Wine for an ARM-based Android, in order to run WinRT applications, you will need to make sure you have the <a href="https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=a4780adeefd042482f624f5e0d577bf9cdcbb760"><code class="language-plaintext highlighter-rouge">tpidrurw</code></a> patch applied to your device’s kernel. There’s a tool that you can build to check this over at <a href="https://github.com/AndreRH/tpidrurw-test">https://github.com/AndreRH/tpidrurw-test</a>.</p><h2 id="for-the-lazy"><span class="mr-2">For the Lazy</span><a href="#for-the-lazy" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2></h2><p>There’s already some automated builds for Wine on Android on the official download site. Check them out here if your device is supported: <a href="https://dl.winehq.org/wine-builds/android">https://dl.winehq.org/wine-builds/android</a>.</p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/general/'>general</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Building Wine 3.0 for Android - Josh Talk&amp;url=https://joshumax.github.io/general/2018/01/19/building-wine-3-0-on-android.html" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Building Wine 3.0 for Android - Josh Talk&amp;u=https://joshumax.github.io/general/2018/01/19/building-wine-3-0-on-android.html" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https://joshumax.github.io/general/2018/01/19/building-wine-3-0-on-android.html&amp;text=Building Wine 3.0 for Android - Josh Talk" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div class="col-12 col-lg-11 col-xl-8"><div id="tail-wrapper" class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/general/2017/06/08/how-torch-broke-ls.html"><div class="card-body"> <em class="timeago small" data-ts="1496880000" > 2017-06-08 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>How Torch broke ls and made me vulnerable (or the hidden dangers of LD_LIBRARY_PATH)</h3><div class="text-muted small"><p> So, today I decided to check out the firmware of a wireless router using the amazing utility known as binwalk. Nothing too unusual and everything seemed to work quite smoothly: Then I went to cd...</p></div></div></a></div><div class="card"> <a href="/general/2021/08/11/running-doom-on-captioncall.html"><div class="card-body"> <em class="timeago small" data-ts="1628640000" > 2021-08-11 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Running DOOM on a Hacked CaptionCall Landline</h3><div class="text-muted small"><p> Recently, I came across a very interesting telephone service called CaptionCall. For those of you who don’t know about this service, it’s essentially a government-funded telephone captioning ser...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/general/2017/06/08/how-torch-broke-ls.html" class="btn btn-outline-primary" prompt="Older"><p>How Torch broke ls and made me vulnerable (or the hidden dangers of LD_LIBRARY_PATH)</p></a> <a href="/general/2021/08/11/running-doom-on-captioncall.html" class="btn btn-outline-primary" prompt="Newer"><p>Running DOOM on a Hacked CaptionCall Landline</p></a></div></div></div></div><footer class="d-flex w-100 justify-content-center"><div class="d-flex justify-content-between align-items-center text-muted"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://twitter.com/joshumax">Josh Max</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script>
